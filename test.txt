Testing end-to-end flow